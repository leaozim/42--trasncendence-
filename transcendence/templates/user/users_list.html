<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User List</title>
</head>
<body>
    <h1>User List</h1>
    <ul>
        {% for user in users %}
            {% if user != request.user %}
                <li>
                    <span>{{ user.username }}</span>
                    <button onclick="onUserClick(`{{ user.id }}`, '{{ user.username }}')">Chat</button>   
                    <button onclick="onCreateGame(`{{ user.id }}`)">Create Game</button>             
                </li>
            {% endif %}
        {% endfor %}
    </ul>

    <script>
        function onUserClick(userId, username) {

            if (!userId || isNaN(userId)) {
                console.error('ID do usuário inválido:', userId);
                return;
            }
            //mudar para ir para o perfil do usuario
            fetch( "http://localhost:8000/chat/create_or_open_chat/" + userId)
            .then(response => response.json())
                .then(data => {
                    window.location.pathname = '/chat/' + data.room_name + '/';
                })
                .catch(error => console.error('Erro ao criar/abrir sala:', error));
        }



        function onCreateGame(rightPlayerId) {
            if (!rightPlayerId || isNaN(rightPlayerId)) {
                console.error('Invalid user ID for the right player:', rightPlayerId);
                return;
            }
        
            fetch("http://localhost:8000/game/create_game/" + rightPlayerId)
            .then(response => response.json())
                .then(data => {
                    console.log("aaaaaaaaaaaaaaaaaaaa", data);
                    window.location.pathname = '/game/' + data.room_name + '/';

                })
                .catch(error => {
                    console.error('Error creating game:', error);
                });
        }


        function getCookie(name) {
            var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
            if (match) return match[2];
        }
    </script>
</body>>